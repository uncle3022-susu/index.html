<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>å·¥ç¨‹å¸³æœ¬ (ä¿®å¾©ç‰ˆ)</title>
    <style>
        /* --- 1. æ ¸å¿ƒè®Šæ•¸ (æŠ¹èŒ¶ç¶ ä¸»é¡Œ) --- */
        :root {
            --primary: #5B9A8B; 
            --primary-grad: linear-gradient(135deg, #66BB6A, #43A047);
            --bg-body: #F4F7F6; 
            --bg-card: #FFFFFF;
            --text-main: #2C3E50; 
            --text-sub: #95A5A6;
            --border: #ECF0F1;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --radius-box: 18px;
            --radius-btn: 14px;
        }

        [data-mode="dark"] {
            --bg-body: #121212; --bg-card: #1E1E1E; --text-main: #E0E0E0; --text-sub: #A0A0A0; --border: #333;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body {
            margin: 0; background: var(--bg-body); color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding-bottom: calc(90px + env(safe-area-inset-bottom));
            overflow-x: hidden;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .header-bar {
            position: sticky; top: 0; z-index: 50;
            background: rgba(244, 247, 246, 0.95);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            padding: 12px 20px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        /* æ»¾è¼ªè§¸ç™¼æŒ‰éˆ• */
        .date-trigger-btn {
            font-size: 1.4rem; font-weight: 700; color: var(--text-main);
            background: transparent; border: none; cursor: pointer;
            display: flex; align-items: center; gap: 6px; padding: 5px 0;
        }
        .date-trigger-btn span { pointer-events: none; }
        .date-trigger-btn::after { content: "â–¼"; font-size: 0.7rem; opacity: 0.5; margin-left: 5px; }

        /* é€šç”¨å¡ç‰‡ */
        .page { display: none; padding: 15px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card { 
            background: var(--bg-card); border-radius: var(--radius-box); padding: 15px; margin-bottom: 15px; 
            box-shadow: var(--shadow); border: 1px solid var(--border);
        }

        /* æ—¥æ›†ç¶²æ ¼ */
        .grid-7 { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; }
        .week-header { font-size: 0.8rem; color: var(--text-sub); padding-bottom: 8px; margin-bottom: 8px; border-bottom: 1px solid var(--border); }
        .day-cell {
            height: 55px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            border-radius: 10px; padding: 4px; cursor: pointer; position: relative;
        }
        .day-num { font-size: 1rem; font-weight: 500; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; z-index: 2; }
        .day-cell.today .day-num { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .day-dot { width: 5px; height: 5px; border-radius: 50%; margin-top: 4px; background: transparent; }
        .has-work .day-dot { background: var(--primary); }

        /* æŒ‰éˆ•èˆ‡è¼¸å…¥æ¡† */
        .btn { 
            width: 100%; padding: 14px; border: none; border-radius: var(--radius-btn); 
            font-weight: 700; font-size: 16px; cursor: pointer; color: white; 
            background: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            transition: transform 0.1s; margin-top: 10px;
        }
        .btn:active { transform: scale(0.96); }
        .btn-danger { background: #FF6B6B; }
        .input-f { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 16px; background: var(--bg-body); color: var(--text-main); outline: none; margin-bottom: 10px; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: calc(70px + env(safe-area-inset-bottom));
            background: var(--bg-card); border-top: 1px solid var(--border); 
            display: flex; justify-content: space-around; padding-bottom: env(safe-area-inset-bottom); 
            z-index: 90;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-sub); font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; stroke: currentColor; stroke-width: 2; fill: none; }

        /* æ»¾è¼ªé¸æ“‡å™¨èˆ‡ Modal */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 2000; display: none; opacity: 0; transition: opacity 0.2s;
            align-items: flex-end; justify-content: center;
        }
        .modal-box {
            width: 100%; background: var(--bg-card); border-radius: 20px 20px 0 0; padding: 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.1, 0.9, 0.2, 1);
            max-height: 80vh; overflow-y: auto;
        }
        
        /* æ»¾è¼ªæ¨£å¼ */
        .picker-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; font-size: 1.1rem; color: var(--primary); }
        .picker-body { display: flex; height: 180px; position: relative; overflow: hidden; mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent); }
        .wheel { flex: 1; overflow-y: scroll; scroll-snap-type: y mandatory; text-align: center; padding: 70px 0; }
        .wheel::-webkit-scrollbar { display: none; }
        .wheel-item { height: 40px; line-height: 40px; font-size: 1.1rem; scroll-snap-align: center; color: var(--text-sub); opacity: 0.4; }
        .wheel-item.selected { color: var(--text-main); font-size: 1.3rem; font-weight: bold; opacity: 1; }
        .wheel-highlight { position: absolute; top: 50%; left: 0; width: 100%; height: 40px; margin-top: -20px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); pointer-events: none; }

        /* ä¸»é¡Œçƒ */
        .theme-row { display: flex; gap: 15px; justify-content: center; margin-top: 15px; }
        .theme-dot { width: 45px; height: 45px; border-radius: 50%; border: 3px solid transparent; cursor: pointer; }
        .theme-dot.active { border-color: var(--text-main); transform: scale(1.1); }
    </style>
</head>
<body>

    <header class="header-bar">
        <button class="date-trigger-btn" onclick="openDatePicker()">
            <span id="dispYear">2026</span>å¹´ <span id="dispMonth">1</span>æœˆ
        </button>
        <div onclick="switchPage('set')" style="font-size:1.2rem; opacity:0.6;">âš™ï¸</div>
    </header>

    <main>
        <section id="pg-cal" class="page active">
            <div class="card">
                <div class="grid-7 week-header">
                    <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                </div>
                <div id="calGrid" class="grid-7"></div>
            </div>
            <div id="dayDetail" style="display:none; margin-top:10px;">
                <h3 id="selDateTxt" style="margin:0 0 10px 0;"></h3>
                <div id="siteList"></div>
                <button class="btn" onclick="openSiteEdit()">+ æ–°å¢æ¡ˆå ´</button>
            </div>
        </section>

        <section id="pg-work" class="page">
            <div class="card" style="background: var(--text-main); color: white;">
                <div style="opacity:0.8; font-size:0.9rem">æœ¬æœˆé ä¼°æ”¯å‡º</div>
                <div id="totalExp" style="font-size:2.2rem; font-weight:800; margin:5px 0">$0</div>
            </div>
            <input type="text" class="input-f" placeholder="ğŸ” æœå°‹å¸«å‚…..." oninput="renderWorkers(this.value)">
            <button class="btn" onclick="openWorkerEdit()">+ æ–°å¢å¸«å‚…</button>
            <div id="workerList" style="margin-top:15px"></div>
        </section>

        <section id="pg-set" class="page">
            <div class="card">
                <h3>ğŸ¨ é¸æ“‡ä¸»é¡Œé¡è‰²</h3>
                <div class="theme-row" id="themeBox"></div>
            </div>
            <div class="card">
                <h3>ğŸ›  è³‡æ–™åº«</h3>
                <button class="btn btn-danger" onclick="resetApp()">âš ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™</button>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" id="nav-cal" onclick="switchPage('cal')">
            <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg><span>æ—¥æ›†</span>
        </div>
        <div class="nav-item" id="nav-work" onclick="switchPage('work')">
            <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path></svg><span>äººå“¡</span>
        </div>
        <div class="nav-item" id="nav-set" onclick="switchPage('set')">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg><span>è¨­å®š</span>
        </div>
    </nav>

    <div id="modalDate" class="overlay" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="picker-header">
                <span onclick="closeModal()" style="font-weight:400; color:#999; cursor:pointer">å–æ¶ˆ</span>
                <span>é¸æ“‡æœˆä»½</span>
                <span onclick="confirmDate()" style="cursor:pointer">ç¢ºå®š</span>
            </div>
            <div class="picker-body">
                <div class="wheel-highlight"></div>
                <div id="wh-y" class="wheel"></div>
                <div id="wh-m" class="wheel"></div>
            </div>
        </div>
    </div>

    <div id="modalInput" class="overlay" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div id="inputBody"></div>
        </div>
    </div>

<script>
// --- å…¨åŸŸè®Šæ•¸ ---
// æ³¨æ„ï¼šæˆ‘æ›´æ›äº† key ç‚º 'ENG_LEDGER_V3' ç¢ºä¿ä¸è®€å–èˆŠçš„éŒ¯èª¤è³‡æ–™
const DB_KEY = 'ENG_LEDGER_V3';
let db = { workers: [], sites: [], theme: 'matcha' };
let curDate = new Date();
let selDate = "";

// ä¸»é¡Œå®šç¾©
const THEMES = {
    'matcha': { color: '#5B9A8B', bg: '#F4F7F6' },
    'ocean':  { color: '#2563EB', bg: '#F0F9FF' },
    'sunset': { color: '#EA580C', bg: '#FFF7ED' },
    'dark':   { color: '#6366F1', bg: '#121212', mode:'dark' }
};

// --- åˆå§‹åŒ– (éŒ¯èª¤è™•ç†) ---
window.onload = function() {
    try {
        const raw = localStorage.getItem(DB_KEY);
        if (raw) db = JSON.parse(raw);
        
        // ç¢ºä¿çµæ§‹å®Œæ•´ (ä¿®å¾©å¯èƒ½çš„ undefined éŒ¯èª¤)
        if(!Array.isArray(db.workers)) db.workers = [];
        if(!Array.isArray(db.sites)) db.sites = [];
        if(!db.theme) db.theme = 'matcha';

        applyTheme(db.theme);
        curDate.setDate(1); // è¨­ç‚º1è™Ÿé¿å…æœˆåº•åˆ‡æ›Bug
        renderAll();
    } catch (e) {
        alert("è³‡æ–™è®€å–éŒ¯èª¤ï¼Œç³»çµ±å°‡è‡ªå‹•é‡ç½®ã€‚\n" + e.message);
        localStorage.removeItem(DB_KEY);
        location.reload();
    }
};

function save() {
    localStorage.setItem(DB_KEY, JSON.stringify(db));
}

// --- ä»‹é¢æ¸²æŸ“ ---
function renderAll() {
    // æ›´æ–°æ¨™é¡Œ
    document.getElementById('dispYear').innerText = curDate.getFullYear();
    document.getElementById('dispMonth').innerText = curDate.getMonth() + 1;
    
    renderCal();
    renderWorkers();
    renderThemes();
}

function renderCal() {
    const grid = document.getElementById('calGrid');
    grid.innerHTML = "";
    const y = curDate.getFullYear(), m = curDate.getMonth();
    
    // è¨ˆç®—ç©ºç™½
    const firstDay = new Date(y, m, 1).getDay();
    const daysInM = new Date(y, m+1, 0).getDate();
    
    for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;
    
    const today = new Date();
    
    for(let d=1; d<=daysInM; d++) {
        const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const hasWork = db.sites.some(s => s.date === dateStr);
        const isToday = (today.getFullYear()===y && today.getMonth()===m && today.getDate()===d);
        
        grid.innerHTML += `
            <div class="day-cell ${isToday?'today':''} ${hasWork?'has-work':''}" onclick="clkDay('${dateStr}')">
                <div class="day-num">${d}</div>
                <div class="day-dot"></div>
            </div>`;
    }
}

function clkDay(str) {
    selDate = str;
    document.getElementById('selDateTxt').innerText = `ğŸ“… ${str}`;
    document.getElementById('dayDetail').style.display = 'block';
    const list = document.getElementById('siteList');
    list.innerHTML = "";
    
    const sites = db.sites.filter(s => s.date === str);
    if(sites.length === 0) list.innerHTML = `<div style="color:#aaa;text-align:center;padding:10px">ç„¡è³‡æ–™</div>`;
    
    sites.forEach(s => {
        list.innerHTML += `
            <div class="card" style="padding:12px; display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
                <div><b>${s.name}</b> <span style="font-size:0.8rem;color:#888">${s.wIds.length}äºº</span></div>
                <button class="btn btn-danger" style="width:auto;margin:0;padding:6px 12px;font-size:12px" onclick="delSite('${s.id}')">åˆª</button>
            </div>`;
    });
    
    // è‡ªå‹•æ²å‹•åˆ°ä¸‹æ–¹
    setTimeout(() => document.getElementById('dayDetail').scrollIntoView({behavior:'smooth'}), 100);
}

function renderWorkers(filter = "") {
    const list = document.getElementById('workerList');
    if(!list) return; // é¿å…åœ¨éäººå“¡é å‡ºéŒ¯
    list.innerHTML = "";
    let total = 0;
    const ym = `${curDate.getFullYear()}-${String(curDate.getMonth()+1).padStart(2,'0')}`;
    
    db.workers.forEach(w => {
        if(filter && !w.name.includes(filter)) return;
        
        // ç°¡å–®è¨ˆç®—
        let count = db.sites.filter(s => s.date.startsWith(ym) && s.wIds.includes(w.id)).length;
        let sub = count * Number(w.rate);
        total += sub;
        
        list.innerHTML += `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:15px;" onclick="openWorkerEdit('${w.id}')">
                <div><b>${w.name}</b><div style="font-size:0.8rem;color:#999">$${w.rate}/æ—¥</div></div>
                <div style="text-align:right">
                    <div style="font-weight:bold;color:var(--primary)">$${sub.toLocaleString()}</div>
                    <div style="font-size:0.8rem;color:#999">${count}å·¥</div>
                </div>
            </div>`;
    });
    document.getElementById('totalExp').innerText = `$${total.toLocaleString()}`;
}

// --- ç·¨è¼¯åŠŸèƒ½ (å½ˆçª—) ---
function openWorkerEdit(id) {
    const w = id ? db.workers.find(x => x.id === id) : {id:'', name:'', rate:''};
    const html = `
        <h3>${id?'ç·¨è¼¯':'æ–°å¢'}å¸«å‚…</h3>
        <input id="inpName" class="input-f" placeholder="å§“å" value="${w.name}">
        <input id="inpRate" type="number" class="input-f" placeholder="æ—¥è–ª" value="${w.rate}">
        <button class="btn" onclick="saveWorker('${w.id}')">å„²å­˜</button>
        ${id ? `<button class="btn btn-danger" onclick="delWorker('${w.id}')">åˆªé™¤å¸«å‚…</button>` : ''}
    `;
    showInputModal(html);
}

function saveWorker(id) {
    const name = document.getElementById('inpName').value;
    const rate = document.getElementById('inpRate').value;
    if(!name) return alert("è«‹è¼¸å…¥å§“å");
    
    if(id) {
        const w = db.workers.find(x => x.id === id);
        w.name = name; w.rate = rate;
    } else {
        db.workers.push({ id: 'w'+Date.now(), name, rate });
    }
    save(); closeModal(); renderWorkers();
}

function delWorker(id) {
    if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
        db.workers = db.workers.filter(x => x.id !== id);
        save(); closeModal(); renderWorkers();
    }
}

function openSiteEdit() {
    const html = `
        <h3>æ–°å¢æ¡ˆå ´ (${selDate})</h3>
        <input id="inpSite" class="input-f" placeholder="æ¡ˆå ´åç¨±">
        <div style="max-height:150px; overflow-y:auto; margin:10px 0; border:1px solid #eee; padding:10px; border-radius:10px">
            ${db.workers.map(w => `
                <div style="padding:5px 0"><label><input type="checkbox" class="wk-chk" value="${w.id}"> ${w.name}</label></div>
            `).join('')}
        </div>
        <button class="btn" onclick="saveSite()">å„²å­˜</button>
    `;
    showInputModal(html);
}

function saveSite() {
    const name = document.getElementById('inpSite').value;
    if(!name) return alert("è«‹è¼¸å…¥åç¨±");
    const chks = document.querySelectorAll('.wk-chk:checked');
    const wIds = Array.from(chks).map(c => c.value);
    
    db.sites.push({ id:'s'+Date.now(), date:selDate, name, wIds });
    save(); closeModal(); renderCal(); clkDay(selDate); renderWorkers();
}

function delSite(id) {
    if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
        db.sites = db.sites.filter(s => s.id !== id);
        save(); renderCal(); clkDay(selDate); renderWorkers();
    }
}

// --- æ»¾è¼ªé‚è¼¯ (Simplified for stability) ---
let wheelY, wheelM;
function openDatePicker() {
    const o = document.getElementById('modalDate');
    o.style.display = 'flex';
    setTimeout(() => { o.style.opacity = 1; o.querySelector('.modal-box').style.transform = 'translateY(0)'; }, 10);
    
    // ç”Ÿæˆæ»¾è¼ªå…§å®¹
    genWheel('wh-y', 2020, 2035, curDate.getFullYear());
    genWheel('wh-m', 1, 12, curDate.getMonth()+1);
}

function genWheel(id, min, max, cur) {
    const el = document.getElementById(id);
    el.innerHTML = `<div style="height:70px"></div>`; // spacer
    for(let i=min; i<=max; i++) {
        const div = document.createElement('div');
        div.className = `wheel-item ${i===cur?'selected':''}`;
        div.innerText = i + (id==='wh-y'?'å¹´':'æœˆ');
        div.dataset.val = i;
        el.appendChild(div);
    }
    el.innerHTML += `<div style="height:70px"></div>`; // spacer
    
    // è‡ªå‹•æ»¾å‹•åˆ°é¸ä¸­ä½ç½®
    setTimeout(() => {
        const sel = el.querySelector('.selected');
        if(sel) el.scrollTop = sel.offsetTop - 70;
    }, 50);

    // ç›£è½æ»¾å‹• (ç°¡å–®ç‰ˆ)
    el.onscroll = () => {
        const center = el.scrollTop + 90;
        el.querySelectorAll('.wheel-item').forEach(d => {
            const top = d.offsetTop;
            if(top > center-25 && top < center+25) {
                el.querySelectorAll('.selected').forEach(x=>x.classList.remove('selected'));
                d.classList.add('selected');
            }
        });
    };
}

function confirmDate() {
    const yEl = document.querySelector('#wh-y .selected');
    const mEl = document.querySelector('#wh-m .selected');
    if(yEl && mEl) {
        curDate.setFullYear(parseInt(yEl.dataset.val));
        curDate.setMonth(parseInt(mEl.dataset.val)-1);
        renderAll();
    }
    closeModal();
}

// --- ç³»çµ±åŠŸèƒ½ ---
function showInputModal(html) {
    document.getElementById('inputBody').innerHTML = html;
    const o = document.getElementById('modalInput');
    o.style.display = 'flex';
    setTimeout(() => { o.style.opacity=1; o.querySelector('.modal-box').style.transform = 'translateY(0)'; }, 10);
}

function closeModal() {
    document.querySelectorAll('.overlay').forEach(o => {
        o.style.opacity=0;
        const box = o.querySelector('.modal-box');
        if(box) box.style.transform = 'translateY(100%)';
        setTimeout(() => o.style.display='none', 300);
    });
}

function switchPage(p) {
    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
    document.getElementById('pg-'+p).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
    document.getElementById('nav-'+p).classList.add('active');
}

function renderThemes() {
    const box = document.getElementById('themeBox');
    box.innerHTML = "";
    for(let k in THEMES) {
        box.innerHTML += `<div class="theme-dot ${db.theme===k?'active':''}" style="background:${THEMES[k].color}" onclick="applyTheme('${k}')"></div>`;
    }
}

function applyTheme(key) {
    db.theme = key;
    save();
    const t = THEMES[key];
    const r = document.documentElement.style;
    r.setProperty('--primary', t.color);
    r.setProperty('--bg-body', t.bg);
    if(t.mode==='dark') document.documentElement.setAttribute('data-mode','dark');
    else document.documentElement.removeAttribute('data-mode');
    renderThemes();
}

function resetApp() {
    if(confirm("è­¦å‘Šï¼šé€™æœƒåˆªé™¤æ‰€æœ‰è³‡æ–™ï¼")) {
        localStorage.removeItem(DB_KEY);
        location.reload();
    }
}
</script>
</body>
</html>
